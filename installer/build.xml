<?xml version="1.0" encoding="UTF-8"?>

<project name="geonetwork" default="installer" basedir=".">

	<!-- =================================================================================== -->
	
	<property file="../web/geonetwork/WEB-INF/server.prop"/>
	
	<!-- =================================================================================== -->
	
	<taskdef name     ="izpack" 
				classpath="lib/standalone-compiler.jar" 
				classname="com.izforge.izpack.ant.IzPackTask"/>
	
	<taskdef name="launch4j"
	        classname="net.sf.launch4j.ant.Launch4jTask"
	        classpath="launch4j/macosx/launch4j.jar:launch4j/macosx/lib/xstream.jar"/>

	<!-- =================================================================================== -->

	<target name="setProperties">
		<propertyfile
		    file="../web/geonetwork/WEB-INF/server.prop"
		    comment="GeoNetwork opensource properties. These are also used by both gast and geonetwork at runtime">
			<!-- ### these are used by both gast and geonetwork at runtime -->
			<!-- Don't remove !! -->
			<entry  key="version" value="2.1.0.0"/>
			<entry  key="subVersion" value="RC2"/>

			<entry  key="release" value="2.1.0"/>
			<entry  key="date" type="date" value="now" pattern="yymmddHHmm"/>
		  
		</propertyfile>
	</target>
		
	<!-- =================================================================================== -->

	<target name="installer" depends="setProperties">
		
		<ant dir=".." target="all" />
		
		<delete dir =".build" />
		<mkdir  dir =".build" />
		
		<!-- file copying -->
			
		<copy todir=".build">
			<fileset dir=".."/>
		</copy>
			
		<delete dir="../geonetwork-${release}"/>
		<mkdir  dir="../geonetwork-${release}"/>
		
		<izpack	input="${basedir}/installer-config.xml" 
					output="../geonetwork-${release}/geonetwork-install.jar" 
					installerType="standard" 
					basedir="${basedir}"/>
				
		<!-- create zip package -->
	
<!--		<copy todir="../geonetwork-${release}">
			<fileset dir="zip"/>
		</copy> -->
		
<!--		<zip destfile = "../geonetwork-${release}.zip"
			  basedir  = "../geonetwork-${release}"/> -->
	
	</target>
	
	<target name="wininstall">
		<!-- create Windows installer -->
		
		<launch4j configFile="${basedir}/launch4j/launch4jConfig.xml"
			jar="../geonetwork-${release}/geonetwork-install.jar"
			outfile="../geonetwork-${release}/geonetwork-install.exe"
			txtFileVersion="${version}-${subVersion}-${day}" 
			txtProductVersion="${version}" 
			fileVersion="${version}" 
			productVersion="${version}"/>

	</target>

	<target name="clean">
		<delete dir =".build" />
		<delete dir="../geonetwork-${release}"/>
	</target>

	<!-- =================================================================================== -->
	
</project>
