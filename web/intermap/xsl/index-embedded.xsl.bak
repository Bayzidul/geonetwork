<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
	
	<xsl:template match="/">
<!--		<html>
			<head>
				<title>
					<xsl:value-of select="/root/gui/strings/title" />
				</title>
				
-->
		<root>
			<info>
				<xsl:copy-of  select="//minimap" />				
			</info>
			<html>
				

		<div id="intermap_root"> <!-- class will be set to current tool -->
<!--				<link rel="stylesheet" type="text/css" href="/intermap/intermap-embedded.css?" />-->
				
<!--				<script language="javascript" src="/intermap/scripts/prototype.js" />
				<script language="javascript" src="/intermap/scripts/scriptaculous/scriptaculous.js?load=slider,effects,dragdrop" />-->
<!--				<script language="javascript" src="/intermap/scripts/util.js" />
				<script language="javascript" src="/intermap/scripts/gui.js?" />
				<script language="javascript" src="/intermap/scripts/connectors/intermap.js?" />
-->				
<!--				<script language="JavaScript" type="text/javascript">
					var minLayersDivWidth = 236;
				
					// Initialize
					function im_init()
					{
						initDivs();
						
						window.name = "InterMap";
						window.focus();
												
						//Event.observe(document, 'mousedown', resizeLayersDivStart);
						new Draggable('im_resizeBar', {constraint:'horizontal',change:resizeLayersDiv});
						
						Event.observe('im_map', 'mousedown', mousedownEventListener);						
						
						setTool('zoomin'); // set the default tool
						
						appendLayers(); // append layers to list
						setLayersDivWidth(minLayersDivWidth);
						
						//Event.observe('geonetRecords', 'mouseover', function(){ $('geonetRecords').className = 'opaque'; });
						//Event.observe('geonetRecords', 'mouseout', function(){ $('geonetRecords').className = ''; });
						
						// keyboard events
						Event.observe(document, 'keypress', function(e) { keyPressed(e) });
					}
					
					function initDivs()
					{
						$('im_map').style.height = <xsl:value-of select="/root/response/mapRoot/response/imageHeight" /> + 'px';
						$('im_map').style.width = <xsl:value-of select="/root/response/mapRoot/response/imageWidth" /> + 'px';
						
						updateDivs();
					}
					
					function updateDivs()
					{
						var height = getWindowSize()[1]; // - Element.getHeight('banner');
						
						$('im_layers').style.height = height + 'px';
						$('im_resizeBar').style.height = height + 'px';
					}
				</script>
-->		
<!--			</head>
			
			<body onLoad="javascript:init();" onResize="javascript:updateDivs();">
						
						-->
			
			<div id="im_resizeBar" style="display:none;"/> <!-- DUMMY -->
			
			<table class="padded_content">
				<tr>
					<!-- TOOLBAR -->
					<td>
						<table id="im_toolbar" class="padded_content">
							<tr id="im_toolSelector"> <!--class="im_tool"-->
								<td class="im_tool" id="im_tool_fullextent"  onClick="javascript:fullExtentButtonListener()"><img src="/intermap/images/zoomfull.png" title="Zoom full extent"/>Full</td>
								<td class="im_tool" id="im_tool_zoomin"	onClick="javascript:setTool('zoomin');" ><img src="/intermap/images/zoomin.png" title="Zoom in"/></td>
								<td class="im_tool" id="im_tool_zoomout"   onClick="javascript:setTool('zoomout');"><img  src="/intermap/images/zoomout.png" title="Zoom out"/></td>
								<td class="im_tool" id="im_tool_zoomsel"	onClick="javascript:imc_zoomToLayer(activeLayerId)"><img src="/intermap/images/zoomsel.png" title="Zoom to selected"/></td>
								<td class="im_tool" id="im_tool_pan"	onClick="javascript:setTool('pan');"><img src="/intermap/images/pan.png" title="Pan"/></td>
								<td class="im_tool" id="im_tool_aoi"	onClick="javascript:setTool('aoi')"><img src="/intermap/images/im_aoi.png" title="Area of interest"/></td> 
<!--								<td class="im_tool" id="im_tool_identify"	onClick="javascript:setTool('identify');">Identify</td>-->
								<td class="im_tool"			onClick="javascript:print();" ><img src="/intermap/images/print.png" title="Print"/></td>
								<td class="im_tool"  			onClick="javascript:resizeImage()">+/- map</td>
								<td class="im_tool"			onClick="{/root/gui/locService}/mapServers.listServers">Add layer</td>
								<td class="im_tool" id="im_tool_reset"	onClick="{/root/gui/locService}/map.reset">Reset</td>
								
							</tr>
							
						</table>
						
					</td>
					
					<!--  LAYERS -->
					<td rowspan="3">
						<div id="im_layers" >
							<xsl:apply-templates select="/root/response/layersRoot" />
						</div>
					</td>					
				</tr>
				
				<tr>
					<td id="im_mapContainer" style="position:relative;width:402px;height:302px;">
						<div id="im_map" style="position: absolute;">
							<img id="im_mapImg" src="{//mapRoot/response/url}" />
						</div>		
						<div id="im_scale" style="position: absolute;" >
							<xsl:variable name="scale"><xsl:value-of select="round(//mapRoot/response/services/distScale)" /></xsl:variable>
							1:<xsl:value-of select="format-number($scale, '###,###')" />
						</div>
						<div id="im_pleaseWait" style="position: absolute; display:none;">Loading map...</div>
					</td>					
				</tr>
				
				<tr>
					<td>
						<table>
							<tr>
								<td style="padding:2px">Add layer</td>
								<td style="padding:2px">Mail map</td>
								<td style="padding:2px">Export PDF</td>
								<td style="padding:2px">Export TIFF</td>
							</tr>
							
								
							
						</table>
						
					</td>
					
				</tr>
				
			</table>
			
				
			<div id="im_inspector" style="display:none;">
				<div id="im_transparencySlider" style="display:none;">
					<div id="im_transparencyHandle" style="display:none;"/> 
				</div>
				<div id="im_transparencyValue" style="display:none;"/>
				<div id="im_legendButton" style="display:none;"/>
			</div>
								
			<div id="im_addLayers" />
				
			<div id="im_debug" />
			<div id="im_geonetRecords" style="display:none" /> <!--  DUMMY -->
			
		</div> <!-- END OF IM CONTAINER -->
			</html>
		</root>
<!--			</body>
		</html>-->
	</xsl:template>
	
	



	<xsl:template match="/root/response/layersRoot">
		
		<div id="im_layersHeader">
			<h3>
				<xsl:value-of select="/root/gui/strings/layers"/>
			</h3>
		</div>
		
		<!-- Layers -->
		<div id="im_layersDiv">
			<ul id="im_layerList" />
		</div>
		
		<table id="im_refresh">
			<tr>
				<td>
					<button id="im_refreshButton" class="im_disabled">
						<xsl:value-of select="/root/gui/strings/refresh" />
					</button>
				</td>
			</tr>
		</table>

		
		<!-- layers toolbar -->
		<div id="im_layersToolbar">
			<!-- delete layer button -->
			<span id="im_deleteLayerButton">delete</span>
			<xsl:text> </xsl:text>
			<!-- add layer button -->
			<!-- 
				<span id="addLayersButton">add</span>
			-->
			<a href="{/root/gui/locService}/mapServers.listServers">add</a>
			<!-- event listeners -->
			<script language="javascript">
				// <![CDATA[
				// Event.observe('im_addLayersButton', 'click', function(e){ addButtonPushed(); });
				Event.observe('im_deleteLayerButton', 'click', function(e){ deleteButtonListener(); });
				Event.observe('im_refreshButton', 'click', function(e){ refreshButtonListener(); });
			// ]]>
			</script>
		</div>
	</xsl:template>

</xsl:stylesheet>
