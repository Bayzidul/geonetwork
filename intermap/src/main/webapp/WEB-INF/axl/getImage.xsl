<?xml version="1.0" encoding="UTF-8"?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">	<xsl:template match="/">		<ARCXML>			<REQUEST>				<GET_IMAGE show="layers">					<PROPERTIES>						<xsl:apply-templates select="/service/envelope/ENVELOPE"/>						<IMAGESIZE>							<xsl:attribute name="width"><xsl:value-of select="service/imageWidth"/></xsl:attribute>							<xsl:attribute name="height"><xsl:value-of select="service/imageHeight"/></xsl:attribute>						</IMAGESIZE>						<LEGEND autoextend="true" />						<xsl:call-template name="layerList"/>						<xsl:apply-templates select="/service/info/ARCXML/RESPONSE/SERVICEINFO/PROPERTIES"/>						<FILTERCOORDSYS id="4326"/>						<FEATURECOORDSYS id="4326"/>						<xsl:apply-templates mode="output" select="/service/info/ARCXML/RESPONSE"/>					</PROPERTIES>				</GET_IMAGE>			</REQUEST>		</ARCXML>	</xsl:template>	<!-- ENVELOPE Element -->	<xsl:template match="ENVELOPE">		<ENVELOPE reaspect="true">			<xsl:attribute name="minx"><xsl:value-of select="@minx"/></xsl:attribute>			<xsl:attribute name="maxx"><xsl:value-of select="@maxx"/></xsl:attribute>			<xsl:attribute name="miny"><xsl:value-of select="@miny"/></xsl:attribute>			<xsl:attribute name="maxy"><xsl:value-of select="@maxy"/></xsl:attribute>		</ENVELOPE>	</xsl:template>	<xsl:template name="layerList">		<LAYERLIST>			<xsl:for-each select="/service/visibleLayers/layer">				<LAYERDEF>					<xsl:variable name="id" select="@internalId"/>					<xsl:attribute name="id"><xsl:value-of select="/service/info/ARCXML/RESPONSE/SERVICEINFO/LAYERINFO[@internalId=$id]/@id"/></xsl:attribute>					<xsl:attribute name="visible"><xsl:value-of select="@visible"/></xsl:attribute>				</LAYERDEF>			</xsl:for-each>		</LAYERLIST>	</xsl:template>	<!-- Set the transparency for the background -->	<xsl:template match="/service/info/ARCXML/RESPONSE/SERVICEINFO/PROPERTIES">		<xsl:choose>			<xsl:when test="BACKGROUND">				<xsl:apply-templates select="BACKGROUND"/>			</xsl:when>			<xsl:otherwise>				<!-- No background tag in the AXL file. Add the background tag and set the transparency -->				<BACKGROUND color="255,255,254" transcolor="255,255,254"/>			</xsl:otherwise>		</xsl:choose>	</xsl:template>	<!-- Set the transparency attribute with the same color as the background -->	<xsl:template match="BACKGROUND">		<BACKGROUND>			<xsl:attribute name="color"><xsl:value-of select="@color"/></xsl:attribute>			<xsl:attribute name="transcolor"><xsl:value-of select="@color"/></xsl:attribute>		</BACKGROUND>	</xsl:template>		<!-- try to get the image in png format -->	<!-- succes depends on the arcims setting 'spatialServer.AllowOutputTypeChange' in the esrimap_prop which is set to true by default in 4.0.1-->	<xsl:template mode="output" match="SERVICEINFO" >		<xsl:choose>			<xsl:when test="count(LAYERINFO[@type='image'])=0">				<OUTPUT type="png8"/>			</xsl:when>			<xsl:otherwise>				<!-- don't specifically request png when there is an image type layer to avoid strange effects -->			</xsl:otherwise>		</xsl:choose>	</xsl:template></xsl:stylesheet>